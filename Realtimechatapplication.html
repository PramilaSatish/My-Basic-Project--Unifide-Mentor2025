<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Appkication</title>
  <style>
 body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }
    .container {
      display: flex;
      height: 100vh;
    }
    .rooms, .chat {
      padding: 20px;
    }
    .rooms {
      width: 25%;
      background: #2c3e50;
      color: white;
      overflow-y: auto;
    }
    .chat {
      width: 75%;
      display: flex;
      flex-direction: column;
    }
    .message-display {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      background: white;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    .message-input {
      display: flex;
    }
    .message-input input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }
    .message-input button {
      padding: 10px;
    }
    .username-container, .room-selection {
      padding: 10px;
      background: #ecf0f1;
    }
    .message {
      margin-bottom: 10px;
    }
    .message span {
      display: block;
      font-size: 12px;
      color: gray;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .rooms, .chat {
        width: 100%;
      }
    }

  </style>
</head>
<body>
  <div class="username-container">
    <label>Enter username: <input id="username" /></label>
    <button onclick="setUsername()">Join</button>
  </div>

  <div class="container" style="display: none" id="chat-app">
    <div class="rooms">
      <h3>Rooms</h3>
      <ul id="room-list">Shreeraj</ul>
      <ul id="room-list">Rasika</ul>
      <ul id="room-list">Shrutika</ul>
      <ul id="room-list">Sharanya</ul>
      <ul id="room-list">Rutuja</ul>
      <ul id="room-list">Yogita</ul>
      <ul id="room-list">Shreeya</ul>
      <ul id="room-list">Satish</ul>
      <ul id="room-list">Pramila</ul>
      <ul id="room-list">Rachana</ul>
      <ul id="room-list">Parnika</ul>
      <ul id="room-list">Aayansh</ul>
      <ul id="room-list">Samartha</ul>

      <input id="new-room" placeholder="New room name" />
      <button onclick="createRoom()">Create Room</button>
    </div>
    <div class="chat">
      <div class="room-selection">Current Room: <span id="current-room">None</span></div>
      <div class="message-display" id="messages">hello</div>
      <div class="message-input">
        <input id="message" placeholder="Type a message..." onkeypress="handleKeyPress(event)" />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

   



  <script>
 let socket;
    let currentRoom = '';
    let username = '';

    function setUsername() {
      const name = document.getElementById('username').value.trim();
      if (!name) return alert('Username required');
      username = name;
      document.querySelector('.username-container').style.display = 'none';
      document.getElementById('chat-app').style.display = 'flex';
      connectWebSocket();
    }

    function connectWebSocket() {
      socket = new WebSocket('ws://localhost:3000');

      socket.onopen = () => {
        socket.send(JSON.stringify({ type: 'setUsername', username }));
        loadRooms();
      };

      socket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'message') displayMessage(data);
        if (data.type === 'roomList') updateRoomList(data.rooms);
      };
    }

    function displayMessage({ sender, message, timestamp }) {
      const msgContainer = document.getElementById('messages');
      const div = document.createElement('div');
      div.className = 'message';
      div.innerHTML = `<strong>${sender}</strong>: ${formatMessage(message)}<span>${new Date(timestamp).toLocaleTimeString()}</span>`;
      msgContainer.appendChild(div);
      msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    function sendMessage() {
      const input = document.getElementById('message');
      const msg = input.value.trim();
      if (!msg || !currentRoom) return;
      socket.send(JSON.stringify({ type: 'message', room: currentRoom, message: msg }));
      input.value = '';
    }

    function formatMessage(msg) {
      return msg.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
                .replace(/\*(.*?)\*/g, '<i>$1</i>')
                .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
    }

    function handleKeyPress(e) {
      if (e.key === 'Enter') sendMessage();
    }

    function createRoom() {
      const room = document.getElementById('new-room').value.trim();
      if (room) {
        socket.send(JSON.stringify({ type: 'createRoom', room }));
        joinRoom(room);
      }
    }

    function joinRoom(room) {
      currentRoom = room;
      document.getElementById('current-room').innerText = room;
      document.getElementById('messages').innerHTML = '';
      socket.send(JSON.stringify({ type: 'joinRoom', room }));
    }

    function loadRooms() {
      socket.send(JSON.stringify({ type: 'getRooms' }));
    }

    function updateRoomList(rooms) {
      const list = document.getElementById('room-list');
      list.innerHTML = '';
      rooms.forEach(room => {
        const li = document.createElement('li');
        li.textContent = room;
        li.style.cursor = 'pointer';
        li.onclick = () => joinRoom(room);
        list.appendChild(li);
      });
    }
  </script>
</body>
</html>